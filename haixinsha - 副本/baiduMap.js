// -----------------------------线路-----------------------------
var line_info = [{
  content: {
    name: '拓展训练营',
    txt: '国际先进的拓展训练器材，完善的配套设施，精锐的培训师资队伍，国际最新培训理念，为......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/num1.png', new BMap.Size(35, 35)),
  position: [113.121924, 22.077296]
}, {
  content: {
    name: '加勒比水公园',
    txt: '加勒比水公园运用先进的造浪技术，使游客真切体验惊涛骇浪之感，更设有儿童戏水区、水上竞技区、水上T台......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/num2.png', new BMap.Size(35, 35)),
  position: [113.121277, 22.076267]
}, {
  content: {
    name: '垂直极限',
    txt: '中国第一台具有双重功能的“垂直极限”，60米的高塔让您同时感受失重和超重的刺激，突然身体垂直向下......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/num3.png', new BMap.Size(35, 35)),
  position: [113.120694, 22.075855]
}, {
  content: {
    name: '海泉神塔',
    txt: '27米高的灯塔高高耸立，熊熊的灯光照耀着全岛；幸福之神希莫娜通过灯火将祝福传递给每一个人。灯塔的底部隐约出现了......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/num4.png', new BMap.Size(35, 35)),
  position: [113.121521, 22.075178]
}];

// -----------------------------餐厅-----------------------------
var eat_info = [{
  content: {
    name: '海港餐厅',
    txt: '海港餐厅，主营海鲜和特色的港式点心、菜式，自开业以来，深受游客的欢迎......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/eat.png', new BMap.Size(50, 50)),
  position: [113.122563, 22.075033]
}, {
  content: {
    name: '海盗餐厅',
    txt: '海盗餐厅，主营海鲜和特色的港式点心、菜式，自开业以来，深受游客的欢迎......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/eat.png', new BMap.Size(50, 50)),
  position: [113.119903, 22.074992]
}, {
  content: {
    name: '幸运餐厅',
    txt: '幸运餐厅，主营海鲜和特色的港式点心、菜式，自开业以来，深受游客的欢迎......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/eat.png', new BMap.Size(50, 50)),
  position: [113.122454, 22.074316]
}];

// -----------------------------游乐-----------------------------
var play_info = [{
  content: {
    name: '拓展训练营',
    txt: '国际先进的拓展训练器材，完善的配套设施，精锐的培训师资队伍，国际最新培训理念，为......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/play.png', new BMap.Size(50, 50)),
  position: [113.121924, 22.077296]
}, {
  content: {
    name: '加勒比水公园',
    txt: '加勒比水公园运用先进的造浪技术，使游客真切体验惊涛骇浪之感，更设有儿童戏水区、水上竞技区、水上T台......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/play.png', new BMap.Size(50, 50)),
  position: [113.121277, 22.076267]
}, {
  content: {
    name: '垂直极限',
    txt: '中国第一台具有双重功能的“垂直极限”，60米的高塔让您同时感受失重和超重的刺激，突然身体垂直向下......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/play.png', new BMap.Size(50, 50)),
  position: [113.120694, 22.075855]
}, {
  content: {
    name: '云霄飞车',
    txt: '中国第一座弹射式"云霄飞车"，首先冲上34米的高塔，再以时速86公里俯冲，然后再冲上一个垂直的360度......',
    img: './img/tc_img3.png'
  },
  iconUrl: new BMap.Icon('./img/play.png', new BMap.Size(50, 50)),
  position: [113.12231, 22.076231]
}];

// -----------------------------卫生间-----------------------------
var wc_info = [{
  content: {
    name: '洗手间',
    txt: '地址：海泉湾路附近',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/wc.png', new BMap.Size(50, 50)),
  position: [113.123244, 22.075627]
}, {
  content: {
    name: '洗手间',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/wc.png', new BMap.Size(50, 50)),
  position: [113.119463, 22.075368]
}, {
  content: {
    name: '洗手间',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/wc.png', new BMap.Size(50, 50)),
  position: [113.122643, 22.073796]
}, {
  content: {
    name: '洗手间',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/wc.png', new BMap.Size(50, 50)),
  position: [113.122518, 22.074676]
}, {
  content: {
    name: '洗手间',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/wc.png', new BMap.Size(50, 50)),
  position: [113.121529, 22.076524]
}];

// -----------------------------停车场-----------------------------
var park_info = [{
  content: {
    name: '神秘岛-停车场',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/park.png', new BMap.Size(50, 50)),
  position: [113.123245, 22.073602]
}, {
  content: {
    name: '神秘岛-停车场',
    txt: '地址：神秘岛门口处',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/park.png', new BMap.Size(50, 50)),
  position: [113.123684, 22.075532]
}, {
  content: {
    name: '海泉湾度假区-停车场',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/park.png', new BMap.Size(50, 50)),
  position: [113.125077, 22.072825]
}];

// -----------------------------便利店-----------------------------
var shop_info = [{
  content: {
    name: '战利品之家',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.122122, 22.076112]
}, {
  content: {
    name: '弄潮零售店',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.120181, 22.074909]
}, {
  content: {
    name: '凯旋者士多',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.122158, 22.07609]
}, {
  content: {
    name: '胆小鬼士多',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.120119, 22.075463]
}, {
  content: {
    name: '喜事多',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.120972, 22.075779]
}, {
  content: {
    name: '宝藏屋',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.120424, 22.074835]
}, {
  content: {
    name: '幸运星',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.122355, 22.075269]
}, {
  content: {
    name: '365度',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.121708, 22.076291]
}, {
  content: {
    name: '勇敢使者',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/shop.png', new BMap.Size(50, 50)),
  position: [113.12188, 22.076493]
}];

// -----------------------------行李寄存-----------------------------
var bag_info = [{
  content: {
    name: '行李寄存',
    txt: '地址：珠海市金湾区平沙镇海泉湾度假区内',
    img: ''
  },
  iconUrl: new BMap.Icon('./img/bag.png', new BMap.Size(50, 50)),
  position: [113.121637, 22.076567]
}];

// -----------------------------用于判断是否显示了底部菜单-----------------------------
var isShowBtm = false;

// -----------------------------百度地图创建-----------------------------
var map = new BMap.Map("allmap");
map.centerAndZoom(new BMap.Point(113.330989,23.117289), 18);
map.enableScrollWheelZoom();
var Bounds = new BMap.Bounds(new BMap.Point(113.322846,23.112947), new BMap.Point(113.341216,23.12006)); // (左下角, 右上角)
try {
  BMapLib.AreaRestriction.setBounds(map, Bounds);
} catch (e) {
  alert(e);
}

/**
 * 添加地图标记点的点击事件
 * @param {内容} content 
 * @param {标记} marker 
 * @param {线路、餐厅、游乐、停车场、洗手间、便利店、寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 */
function addClickHandler(content, marker, classy, idx) {
  marker.addEventListener("click", function (e) {
    if (classy === 'line') {
      openInfoOne(content, 1, idx, e);
    } else if (classy === 'eat') {
      openInfoTwo(content, 2, idx, e);
    } else if (classy === 'play') {
      openInfoThree(content, 3, idx, e);
    } else if (classy === 'park') {
      openInfoOne(content, 4, idx, e);
    } else if (classy === 'wc') {
      openInfoOne(content, 5, idx, e);
    } else if (classy === 'shop') {
      openInfoOne(content, 6, idx, e);
    } else if (classy === 'bag') {
      openInfoOne(content, 7, idx, e);
    }
  });
}

/**
 * 打开信息窗口：线路
 * @param {内容} content 
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 * @param {标记对象} e 
 */
function openInfoOne(content, classy, idx, e) {
  var p = e.target;
  var htmlStr = '<h4 class="marker-name">' + content.name + '</h4>';
  htmlStr = htmlStr + '<div class="marker-cont"><div class="marker-txt-one">' + content.txt + '</div></div><div class="marker-btn">';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="gotoWeChat(' + classy + ',' + idx + ')" class="marker-btn-item gotoBtn"><img src="./img/goto_w.png"><span>去这里</span></a></div>';
  var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
  var infoWindow = new BMap.InfoWindow(htmlStr); // 创建信息窗口对象 
  map.openInfoWindow(infoWindow, point); //开启信息窗口
}

/**
 * 打开信息窗口：餐厅
 * @param {内容} content 
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 * @param {标记对象} e 
 */
function openInfoTwo(content, classy, idx, e) {
  var p = e.target;
  var htmlStr = '<h4 class="marker-name">' + content.name + '</h4>';
  htmlStr = htmlStr + '<div class="marker-cont"><div class="marker-txt-one">' + content.txt + '</div></div><div class="marker-btn">';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="yuyueWeChat(' + classy + ',' + idx + ')" class="marker-btn-item yuyueBtn"><img src="./img/yuyue_w.png"><span>预定</span></a>';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="gotoWeChat(' + classy + ',' + idx + ')" class="marker-btn-item gotoBtn"><img src="./img/goto_w.png"><span>去这里</span></a></div>';
  var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
  var infoWindow = new BMap.InfoWindow(htmlStr); // 创建信息窗口对象 
  map.openInfoWindow(infoWindow, point); //开启信息窗口
}

/**
 * 打开信息窗口：游乐
 * @param {内容} content 
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 * @param {标记对象} e 
 */
function openInfoThree(content, classy, idx, e) {
  var p = e.target;
  var htmlStr = '<h4 class="marker-name">' + content.name + '</h4>';
  htmlStr = htmlStr + '<div class="marker-cont"><div class="marker-img"><img src="' + content.img + '"/></div><div class="marker-txt">' + content.txt + '</div></div><div class="marker-btn">';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="yuyinWeChat(' + classy + ',' + idx + ')" class="marker-btn-item yuyinBtn"><img src="./img/yuyin_w.png"><span>语音</span></a>';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="yuyueWeChat(' + classy + ',' + idx + ')" class="marker-btn-item yuyueBtn"><img src="./img/yuyue_w.png"><span>预定</span></a>';
  htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="gotoWeChat(' + classy + ',' + idx + ')" class="marker-btn-item gotoBtn"><img src="./img/goto_w.png"><span>去这里</span></a></div>';
  var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
  var infoWindow = new BMap.InfoWindow(htmlStr); // 创建信息窗口对象 
  map.openInfoWindow(infoWindow, point); //开启信息窗口
}

/**
 * 语音，跳转小程序
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 */
function yuyinWeChat(classy, idx) {
  console.log('语音', classy, idx);
  var classyArr = '';
  if (classy === 1) {
    classyArr = line_info;
  } else if (classy === 2) {
    classyArr = eat_info;
  } else if (classy === 3) {
    classyArr = play_info;
  } else if (classy === 4) {
    classyArr = park_info;
  } else if (classy === 5) {
    classyArr = wc_info;
  } else if (classy === 6) {
    classyArr = shop_info;
  } else if (classy === 7) {
    classyArr = bag_info;
  }
  wx.miniProgram.navigateTo({
    url: '../player/player'
  });
}

/**
 * 预约，跳转小程序
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 */
function yuyueWeChat(classy, idx) {
  console.log('预约', classy, idx);
  var classyArr = '';
  if (classy === 1) {
    classyArr = line_info;
  } else if (classy === 2) {
    classyArr = eat_info;
  } else if (classy === 3) {
    classyArr = play_info;
  } else if (classy === 4) {
    classyArr = park_info;
  } else if (classy === 5) {
    classyArr = wc_info;
  } else if (classy === 6) {
    classyArr = shop_info;
  } else if (classy === 7) {
    classyArr = bag_info;
  }
  if (classy == 2) {
    wx.miniProgram.navigateTo({
      url: '../restaurant/restaurant'
    });
  } else {
    wx.miniProgram.navigateTo({
      url: '../scheduleDetail/scheduleDetail'
    });
  }
}

/**
 * 去这里，跳转小程序
 * @param {1线路、2餐厅、3游乐、4停车场、5洗手间、6便利店、7寄存行李} classy 
 * @param {对应classy数组的下标} idx 
 */
function gotoWeChat(classy, idx) {
  console.log('去这里', classy, idx);
  var classyArr = '';
  if (classy === 1) {
    classyArr = line_info;
  } else if (classy === 2) {
    classyArr = eat_info;
  } else if (classy === 3) {
    classyArr = play_info;
  } else if (classy === 4) {
    classyArr = park_info;
  } else if (classy === 5) {
    classyArr = wc_info;
  } else if (classy === 6) {
    classyArr = shop_info;
  } else if (classy === 7) {
    classyArr = bag_info;
  }
  console.log(classyArr[idx])
  // 需要调用 wxConfigFun()
  wx.ready(function () {
    wx.openLocation({
      latitude: classyArr[idx].position[1],
      longitude: classyArr[idx].position[0],
      name: classyArr[idx].content.name,
    });
  });
}

/**
 * 微信小程序 wx.config
 * @param {当前页面url} path 
 */
function wxConfigFun(path) {
  $.ajax({
    url: "https://hi.cxtrip.cc/cxyTicket/wechat/spot/getNormalConfig", //后台给你提供的接口
    type: "GET",
    data: {
      "url": path
    },
    async: true,
    dataType: "json",
    success: function (data) {
      wx.config({
        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来
        appId: data.content.appId, // 必填，公众号的唯一标识
        timestamp: data.content.timeStamp, // 必填，生成签名的时间戳
        nonceStr: data.content.nonceStr, // 必填，生成签名的随机串
        signature: data.content.paySign, // 必填，签名，见附录1
        jsApiList: data.content.jsApiList // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
      });
      wx.error(function (res) {
        alert.log('wx', res);
      });
    },
    error: function (error) {
      alert.log('error', error)
    }
  });
}

$(function () {
  // 设置微信config
  wxConfigFun(location.href);
  // 我的（跳转到小程序）
  $('#myBtn').bind('click', function () {
    console.log('跳转小程序')
    wx.miniProgram.redirectTo({
      url: '../personal/index'
    });
  });
  // 头部菜单
  $('.nav-item').bind('click', function () {
    $(this).find('.nav-item-con').addClass('nav-active');
    $(this).siblings().find('.nav-item-con').removeClass('nav-active');
    $(this).find('.nav-img1').addClass('disnone');
    $(this).find('.nav-img2').removeClass('disnone');
    $(this).siblings().find('.nav-img1').removeClass('disnone');
    $(this).siblings().find('.nav-img2').addClass('disnone');
    var setViewArr = []; // 地图标注的点
    map.clearOverlays(); // 清除地图覆盖物
    if ($(this).index() == 0) {
      // ---------------------------------线路------------------------------------------------------------------
      // isShowBtm = !isShowBtm;
      // if (isShowBtm === false) {
      //   $('.rode-line').animate({ // 隐藏线路
      //     height: '0px'
      //   }, 400);
      // } else {
        isShowBtm = true; //打开了底部弹窗
        $('.rode-line').animate({ // 显示线路
          height: '152px'
        }, 400);
        $('.rode-item').eq(0).siblings().find('span').removeClass('active');
        $('.rode-item').eq(0).siblings().find('p').removeClass('active');
        $('.rode-item').eq(0).find('span').addClass('active');
        $('.rode-item').eq(0).find('p').addClass('active');
        line_info.map(function (item, index, self) {
          var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
            icon: item.iconUrl
          }); // 创建标注
          map.addOverlay(marker); // 将标注添加到地图中
          addClickHandler(item.content, marker, 'line', index);
          setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
        });
        map.setViewport(setViewArr); // 自动适配到合适视野范围；无参数，默认包括所有覆盖物的情况
      // }
    } else if ($(this).index() == 1) {
      // ---------------------------------餐饮------------------------------------------------------------------
      isShowBtm = false; //关闭了底部弹窗
      $('.rode-line').animate({ // 隐藏线路
        height: '0px'
      }, 400);
      eat_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'eat', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
      map.setViewport(setViewArr); // 自动适配到合适视野范围；无参数，默认包括所有覆盖物的情况

    } else if ($(this).index() == 2) {
      // ---------------------------------游乐------------------------------------------------------------------
      isShowBtm = false; //关闭了底部弹窗
      $('.rode-line').animate({ // 隐藏线路
        height: '0px'
      }, 400);
      play_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'play', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
      map.setViewport(setViewArr); // 自动适配到合适视野范围；无参数，默认包括所有覆盖物的情况

    } else if ($(this).index() == 3) {
      // ---------------------------------观光车------------------------------------------------------------------
      map.centerAndZoom(new BMap.Point(113.121617, 22.075878), 18); // 初始化地图
      isShowBtm = false; //关闭了底部弹窗
      $('.rode-line').animate({ // 隐藏线路
        height: '0px'
      }, 400);
      $('.mask-box').show(); //显示遮罩层
      $('.msg-box').show(); // 显示弹窗
      $('.msg-con').html('').html('确定呼叫观光车？');
      $('.msg-cancel').bind('click', function () {
        $('.msg-box').hide(); // 隐藏弹窗
        $('.mask-box').hide(); //隐藏遮罩层
        $('.nav-item').find('.nav-item-con').removeClass('nav-active');
        $('.nav-item').find('.nav-img1').removeClass('disnone');
        $('.nav-item').find('.nav-img2').addClass('disnone');
      });
      $('.msg-confirm').bind('click', function () {
        $('.msg-con').html('').html('观光车已经在来的路上，请稍等');
      });
    }
  });

  // 收起线路列表
  $('#takeUp').bind('click', function() {
    isShowBtm = false; //关闭了底部弹窗
    $('.rode-line').animate({ // 隐藏线路
      height: '0px'
    }, 400);
  });

  // 线路：1、2、3、4点击时
  $('.rode-item').bind('click', function () {
    $(this).siblings().find('span').removeClass('active');
    $(this).siblings().find('p').removeClass('active');
    $(this).find('span').addClass('active');
    $(this).find('p').addClass('active');
    const index = $(this).find('span').html() - 1;
    const content = line_info[index].content;
    const position = line_info[index].position;
    var htmlStr = '<h4 class="marker-name">' + content.name + '</h4>';
    htmlStr = htmlStr + '<div class="marker-cont"><div class="marker-txt-one">' + content.txt + '</div></div><div class="marker-btn">';
    htmlStr = htmlStr + '<a href="javascript:void(0);" onclick="gotoWeChat(1,' + index + ')" class="marker-btn-item gotoBtn"><img src="./img/goto_w.png"><span>去这里</span></a></div>';
    var point = new BMap.Point(position[0], position[1]);
    var infoWindow = new BMap.InfoWindow(htmlStr); // 创建信息窗口对象 
    map.openInfoWindow(infoWindow, point); //开启信息窗口
  });

  // 点击遮罩层
  $('.mask-box').bind('click', function () {
    isShowBtm = false; //关闭了底部弹窗
    $(this).hide(); //隐藏遮罩层
    // 菜单
    $('.right-menu').animate({
      height: '0px'
    }, 400);
    // 提示弹窗
    $('.msg-box').hide(); // 隐藏弹窗
  });

  // 地图、实景切换
  var isReal = false; // 是否实景
  $('.switch-bar').bind('click', function() {
    isReal = !isReal;
    $('.switch-circle').eq(0).toggleClass('switch-bg');
    $('.switch-circle').eq(1).toggleClass('switch-bg');
    if (isReal === true) {
      $('.switch-circle').eq(0).html('');
      $('.switch-circle').eq(1).html('实景');
      $('#allmap').hide();
      $('#imgmap').show();
    } else {
      $('.switch-circle').eq(0).html('地图');
      $('.switch-circle').eq(1).html('');
      $('#allmap').show();
      $('#imgmap').hide();
    }
  });

  // 右侧菜单图标
  $('.right-item').bind('click', function () {
    if (isShowBtm == false) {
      if ($(this).index() == 0) {
        // ---------------------------------消息------------------------------------------------------------------
        $(this).find('img').eq(0).toggleClass('disnone');
        $(this).find('img').eq(1).toggleClass('disnone');
        $('.ativity-box').toggleClass('ativity-box-a');
        $('.ativity-info').addClass('disnone');
        $('.ativity-con').bind('click', function () {
          $('.ativity-info').toggleClass('disnone');
        });
      } else if ($(this).index() == 1) {
        // ---------------------------------菜单------------------------------------------------------------------
        isShowBtm = true; //打开了底部弹窗
        $('.mask-box').show(); //显示遮罩层
        $('.right-menu').animate({
          height: '110px'
        }, 400);
      } else if ($(this).index() == 2) {
        // ---------------------------------红包优惠券------------------------------------------------------------------
        console.log('跳转小程序')
        wx.miniProgram.navigateTo({
          url: '../coupon/coupon'
        });
      } else if ($(this).index() == 3) {
        // ---------------------------------客服------------------------------------------------------------------
        console.log('跳转小程序')
        wx.miniProgram.navigateTo({
          url: '../service/service'
        });
      }
    }
  });

  // 菜单列表点击时
  $('.right-menu-item').bind('click', function () {
    $('.nav-item').find('.nav-item-con').removeClass('nav-active');
    $('.nav-item').find('.nav-img1').removeClass('disnone');
    $('.nav-item').find('.nav-img2').addClass('disnone');
    isShowBtm = false;
    $('.mask-box').hide(); //隐藏遮罩层
    $('.right-menu').animate({
      height: '0px'
    }, 400);
    var setViewArr = []; // 地图标注的点
    map.clearOverlays(); // 清除地图覆盖物
    if ($(this).index() == 0) {
      // ---------------------------------停车场------------------------------------------------------------------
      park_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'park', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
    } else if ($(this).index() == 1) {
      // ---------------------------------卫生间------------------------------------------------------------------
      wc_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'wc', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
    } else if ($(this).index() == 2) {
      // ---------------------------------物品租赁------------------------------------------------------------------
      map.centerAndZoom(new BMap.Point(113.121617, 22.075878), 18); // 初始化地图
      console.log('跳转小程序')
      wx.miniProgram.navigateTo({
        url: '../rentPage/rentPage'
      });
    } else if ($(this).index() == 3) {
      // ---------------------------------便利店------------------------------------------------------------------
      shop_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'shop', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
    } else if ($(this).index() == 4) {
      // ---------------------------------行李寄存------------------------------------------------------------------
      bag_info.map(function (item, index, self) {
        var marker = new BMap.Marker(new BMap.Point(item.position[0], item.position[1]), {
          icon: item.iconUrl
        }); // 创建标注
        map.addOverlay(marker); // 将标注添加到地图中
        addClickHandler(item.content, marker, 'bag', index);
        setViewArr.push(new BMap.Point(item.position[0], item.position[1]));
      });
    }
    map.setViewport(setViewArr); // 自动适配到合适视野范围；无参数，默认包括所有覆盖物的情况
  });
});